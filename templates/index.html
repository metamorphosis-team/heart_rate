<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script>
	
	$(function () {
	    display_heart_rate()

        setInterval(function () {
            display_heart_rate()
        }, 3000)
	});

	function display_heart_rate(){
        {#heart_rate = get_heart_rate()#}
        heart_rate = parseInt(Math.random() * 80) + 40
        duration = parseInt((60 / heart_rate) * 1000)
        console.log(duration.toString() + "ms")
        var heart = document.querySelector(".animated")
        heart.style.setProperty("-webkit-animation-duration", duration.toString() + "ms")
        $("#heart_rate").text(parseInt(heart_rate))
    }

	function get_heart_rate(){
	      $.ajax({
            url: 'http://192.168.102.54:4035/gotapi/health/heartRate?accessToken=undefined&serviceId=F3%3A3B%3A15%3A7E%3A29%3ABB.a8e67eb5cd6341bef3872639e61514cc.localhost.deviceconnect.org',
            type: 'GET',
            dataType: 'json',
            // フォーム要素の内容をハッシュ形式に変換
            timeout: 5000,
          })
          .done(function(data) {
              // 通信成功時の処理を記述
              return data.heartRate
          })
          .fail(function() {
              // 通信失敗時の処理を記述
              return -1
          });
    }
</script>
</head>
<body>
	<div id="heart_a">
		<img src="https://raw.githubusercontent.com/metamorphosis-team/heart_rate/master/templates/heart.png" class="animated infinite flash" id="heart" />
	</div>
    <div id="heart_rate"></div>
</body>
</html>